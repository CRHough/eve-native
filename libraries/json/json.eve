# JSON

A library for encoding and decoding Eve records into and from JSON

## Encoding

Encoding starts with a `#json/encode` record.

search
  [#json/encode record]
commit
  [#json/encode/target record]
  [#json/encode/flatten record]
end

Target records are specified for encoding

search
  encode = [#json/encode/target record]
watch json
  ("encode/target", encode, record)
end

Flattening is done recursively. We start with the target record and look up all
a/v pairs. Any v that is also a record (satisfies `lookup[entity]`) we will also
flatten.

search
  [#json/encode/flatten record]
  lookup[entity: record attribute value]
  sub-record = if lookup[entity: value] then value
               else ""
commit
  [#json/encode/flatten record: sub-record]
  [#json/encode/eav record attribute value]
end

Raw EAVs are encoded as JSON

search
  encode = [#json/encode/eav record attribute value]
watch json
  ("encode/eav", encode, record, attribute, value)
end

We get back a `json-string` as a change. Apply it as an attribute to the
original `json/encode`

search
  [#json/encode/change record json-string]
  encode = [#json/encode record]
commit
  encode.json-string := json-string
end

## Decoding

search
  decode = [#json/decode json]
watch json
  ("decode", decode, json)
end